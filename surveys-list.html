<link rel="import" href="survey-item.html">
<link rel="import" href="../sortable-list/sortable-list.html">
<!--
`<surveys-list surveys="{{surveys}}" on-delete-surveys="deleteSurvey"></surveys-list>`
-->
<dom-module id="surveys-list">
  <template>
    <template is="dom-if" if="{{answered}}">
      <template is="dom-repeat" items="{{surveys}}">
        <paper-material style="background:#fff;padding:20px;margin:5px;width:250px;float:left">
          <survey-item data="{{data}}" answered survey="{{item}}"></survey-item>
        </paper-material>
      </template>
    </template>
    <template is="dom-if" if="{{edit}}">
      <sortable-list style="display: inline-block; margin-left: 50px;">
        <template is="dom-repeat" items="{{surveys}}">
          <paper-material style="background:#fff;padding:20px;margin:5px;width:250px;float:left">
            <survey-item data="{{data}}" edit survey="{{item}}" on-delete-survey="deleteSurvey"></survey-item>
          </paper-material>
        </template>
      </sortable-list>
    </template>
    <!-- Survey Questions in the Account -->
    <template is="dom-if" if="{{answer}}">
      <template is="dom-if" if="{{!surveys.length}}">
        <h4>Thank you for you time. All Questions Answered.</h4>
      </template>
      <template is="dom-repeat" items="{{surveys}}" filter="{{filterSurvey(filterBy)}}">
        <paper-material elevation="1" style="padding: 20px; float: left;margin: 10px;">
          <div><survey-item index="[[index]]" answer="[[answer]]" answered="[[answered]]" survey="{{item}}"></survey-item></div>
        </paper-material>
      </template>
    </template>
  </template>
</dom-module>
<script>
  Polymer({
    is: 'surveys-list',
    properties: {
      surveys: {notify:true},
      edit: {type: Boolean, value: false},
      answer: {type: Boolean, value: false},
      answered: {type: Boolean, value: false},
      filterBy: {type:String,value:"not"}
    },
    deleteSurvey: function(e) {
      this.arrayDelete('surveys', e.detail.survey);
    },
    filterSurvey: function(filterBy) {
      if (filterBy) {
        // If filterBy is 'all', return a filter
        if (filterBy === 'all') {
          return function() {
            return true
          }
        }
        // Handle 'completed', or its inverse, 'active'
        var ifNotComplete = !(filterBy === 'completed')
        var ifArchive = (filterBy === 'archive')
        return function(item) {
          if (item.isComplete !== ifNotComplete) {
            if (item.archive === ifArchive) {
              return true
            } else {
              return false
            }
          }
          return false
        }
      }
    }
  });
</script>
